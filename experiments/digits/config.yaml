---
experiment:
  __class__experiment_type: src.experiments.base.ExperimentCollection
  experiment_params:
    name: digits_basedist_comparison
    experiments:
      - experiment:
          __class__experiment_type: src.experiments.hyperopt.HyperoptExperiment
          experiment_params:
            name: digits_laplace
            __class__scheduler: &scheduler ray.tune.schedulers.ASHAScheduler
            num_hyperopt_samples: &num_hyperopt_samples 25
            gpus_per_trial: &gpus_per_trial 0
            scheduler_params: &scheduler_params 
              max_t: 31
              grace_period: 31
              reduction_factor: 2 
            tuner_params: &tuner_params
              metric: val_loss
              mode: min
            trial_config:
              train: &train /Users/fariedabuzaid/Projects/laplace-flows/experiments/digits/mnist_train.csv
              test: &test /Users/fariedabuzaid/Projects/laplace-flows/experiments/digits/mnist_test.csv 
              val: &val /Users/fariedabuzaid/Projects/laplace-flows/experiments/digits/mnist_val.csv
              epochs: &epochs 30 
              iters: &iters 10000
              __tune__batch_size: &batch_size choice([32, 64])
              __class__optim: &optim torch.optim.Adam 
              optim_params: &optim_params
                __tune__lr: loguniform(1e-5, 5e-4)
                weight_decay: 0.0
              
              __class__model: src.veriflow.flows.NiceFlow
              model_params:
                __tune__coupling_layers: &coupling_layers choice([2, 3, 4])
                __tune__coupling_nn_layers: &coupling_nn_layers choice([[128], [32], [64], [128, 128], [32, 32], [64, 64], [32, 128], [64, 32], [32, 64], [128, 32], [64, 128], [128, 64]])
                __tune__split_dim: &split_dim choice([8, 16, 32])
                __tune__nonlinearity: &nonlinearity choice([torch.nn.ReLU(), torch.nn.Softplus(), torch.nn.Sigmoid()])
                base_distribution: Laplace
      - experiment:
          __class__experiment_type: src.experiments.hyperopt.HyperoptExperiment
          experiment_params:
            name: digits_normal
            __class__scheduler: *scheduler
            num_hyperopt_samples: *num_hyperopt_samples
            gpus_per_trial: *gpus_per_trial
            scheduler_params: *scheduler_params
            tuner_params: *tuner_params
            trial_config:
              train: *train
              test: *test 
              val: *val
              epochs: *epochs
              iters: *iters
              __tune__batch_size: *batch_size
              __class__optim: *optim
              optim_params: *optim_params
              
              __class__model: src.veriflow.flows.NiceFlow
              model_params:
                __tune__coupling_layers: *coupling_layers
                __tune__coupling_nn_layers: *coupling_nn_layers
                __tune__split_dim: *split_dim
                __tune__nonlinearity: *nonlinearity
                base_distribution: Normal       
      